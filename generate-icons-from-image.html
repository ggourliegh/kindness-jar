<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA Icon Generator - From Image</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .upload-section {
      margin: 30px 0;
      padding: 30px;
      border: 3px dashed #4CAF50;
      border-radius: 10px;
      text-align: center;
      background: #f9fff9;
    }
    .upload-section.drag-over {
      background: #e8f5e9;
      border-color: #2E7D32;
    }
    #imageInput {
      display: none;
    }
    .upload-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }
    .upload-btn:hover {
      background: #45a049;
    }
    .preview-section {
      display: none;
      margin: 30px 0;
    }
    .preview-section.show {
      display: block;
    }
    .original-preview {
      text-align: center;
      margin: 20px 0;
    }
    #originalCanvas {
      max-width: 100%;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
    .controls {
      margin: 20px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
    }
    .control-group {
      margin: 15px 0;
    }
    label {
      display: inline-block;
      width: 180px;
      font-weight: bold;
    }
    input[type="range"] {
      width: 300px;
      vertical-align: middle;
    }
    .value-display {
      display: inline-block;
      width: 50px;
      text-align: center;
      font-weight: bold;
      color: #4CAF50;
    }
    .icon-preview {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .icon-item {
      text-align: center;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
    }
    .icon-item h3 {
      margin-top: 0;
      color: #555;
    }
    canvas {
      border: 1px solid #ddd;
      margin: 10px 0;
      background: white;
    }
    .download-btn {
      background: #FF6B6B;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    .download-btn:hover {
      background: #ff5252;
    }
    .download-all-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px;
      margin: 20px auto;
      display: block;
    }
    .download-all-btn:hover {
      background: #45a049;
    }
    .status {
      color: green;
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
    }
    .instructions {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      border-left: 4px solid #2196F3;
    }
    .instructions h3 {
      margin-top: 0;
      color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® PWA Icon Generator - From Image</h1>
    <p>Upload your "bee kind" neon sign image and generate PWA icons with automatic white edge cropping!</p>

    <div class="upload-section" id="uploadSection">
      <h2>üì§ Upload Your Image</h2>
      <p>Drag and drop your image here, or click to select</p>
      <input type="file" id="imageInput" accept="image/*">
      <button class="upload-btn" onclick="document.getElementById('imageInput').click()">
        Choose Image
      </button>
    </div>

    <div class="preview-section" id="previewSection">
      <h2>Original Image Preview</h2>
      <div class="original-preview">
        <canvas id="originalCanvas"></canvas>
      </div>

      <div class="controls">
        <h3>‚öôÔ∏è Crop Settings</h3>
        <div class="control-group">
          <label>Crop Threshold:</label>
          <input type="range" id="thresholdSlider" min="200" max="255" value="240" oninput="updateIcons()">
          <span class="value-display" id="thresholdValue">240</span>
          <p style="margin: 5px 0 0 180px; font-size: 12px; color: #666;">
            (Higher = more aggressive cropping of light edges)
          </p>
        </div>
        <div class="control-group">
          <label>Padding:</label>
          <input type="range" id="paddingSlider" min="0" max="50" value="10" oninput="updateIcons()">
          <span class="value-display" id="paddingValue">10</span>
          <p style="margin: 5px 0 0 180px; font-size: 12px; color: #666;">
            (Extra space around cropped image)
          </p>
        </div>
        <div class="control-group">
          <label>Corner Radius:</label>
          <input type="range" id="radiusSlider" min="0" max="30" value="20" oninput="updateIcons()">
          <span class="value-display" id="radiusValue">20</span>
          <p style="margin: 5px 0 0 180px; font-size: 12px; color: #666;">
            (Rounded corners for modern look)
          </p>
        </div>
      </div>

      <h2>Generated PWA Icons</h2>
      <div class="icon-preview">
        <div class="icon-item">
          <h3>192x192</h3>
          <canvas id="canvas192" width="192" height="192"></canvas>
          <br>
          <button class="download-btn" onclick="downloadIcon(192)">Download</button>
        </div>

        <div class="icon-item">
          <h3>512x512</h3>
          <canvas id="canvas512" width="512" height="512"></canvas>
          <br>
          <button class="download-btn" onclick="downloadIcon(512)">Download</button>
        </div>

        <div class="icon-item">
          <h3>180x180 (iOS)</h3>
          <canvas id="canvas180" width="180" height="180"></canvas>
          <br>
          <button class="download-btn" onclick="downloadIcon(180)">Download</button>
        </div>
      </div>

      <button class="download-all-btn" onclick="downloadAll()">
        ‚¨áÔ∏è Download All Icons
      </button>

      <div id="status"></div>

      <div class="instructions">
        <h3>üìã Next Steps:</h3>
        <ol>
          <li>Adjust the crop settings above until the icons look perfect</li>
          <li>Click "Download All Icons" to get all three files</li>
          <li>Save them to the <code>icons/</code> folder:
            <ul>
              <li><code>icon-192x192.png</code></li>
              <li><code>icon-512x512.png</code></li>
              <li><code>apple-touch-icon.png</code></li>
            </ul>
          </li>
          <li>Your PWA will now show this beautiful icon when installed!</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    let uploadedImage = null;
    let croppedBounds = null;

    // File input handling
    document.getElementById('imageInput').addEventListener('change', handleFile);

    // Drag and drop handling
    const uploadSection = document.getElementById('uploadSection');
    uploadSection.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadSection.classList.add('drag-over');
    });
    uploadSection.addEventListener('dragleave', () => {
      uploadSection.classList.remove('drag-over');
    });
    uploadSection.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        loadImage(file);
      }
    });

    function handleFile(e) {
      const file = e.target.files[0];
      if (file) {
        loadImage(file);
      }
    }

    function loadImage(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          uploadedImage = img;
          displayOriginal();
          updateIcons();
          document.getElementById('previewSection').classList.add('show');
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function displayOriginal() {
      const canvas = document.getElementById('originalCanvas');
      const ctx = canvas.getContext('2d');

      // Scale to fit display (max 600px wide)
      const maxWidth = 600;
      const scale = Math.min(1, maxWidth / uploadedImage.width);
      canvas.width = uploadedImage.width * scale;
      canvas.height = uploadedImage.height * scale;

      ctx.drawImage(uploadedImage, 0, 0, canvas.width, canvas.height);
    }

    function getCropBounds(img, threshold) {
      // Create temporary canvas to analyze image
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      let minX = canvas.width;
      let minY = canvas.height;
      let maxX = 0;
      let maxY = 0;

      // Scan image to find non-white pixels
      for (let y = 0; y < canvas.height; y++) {
        for (let x = 0; x < canvas.width; x++) {
          const i = (y * canvas.width + x) * 4;
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          const a = data[i + 3];

          // Check if pixel is not white/transparent
          const isContent = (r < threshold || g < threshold || b < threshold) && a > 50;

          if (isContent) {
            minX = Math.min(minX, x);
            minY = Math.min(minY, y);
            maxX = Math.max(maxX, x);
            maxY = Math.max(maxY, y);
          }
        }
      }

      // Add padding
      const padding = parseInt(document.getElementById('paddingSlider').value);
      minX = Math.max(0, minX - padding);
      minY = Math.max(0, minY - padding);
      maxX = Math.min(canvas.width - 1, maxX + padding);
      maxY = Math.min(canvas.height - 1, maxY + padding);

      return {
        x: minX,
        y: minY,
        width: maxX - minX,
        height: maxY - minY
      };
    }

    function drawIcon(canvas, size) {
      if (!uploadedImage) return;

      const ctx = canvas.getContext('2d');
      const threshold = parseInt(document.getElementById('thresholdSlider').value);
      const cornerRadius = parseInt(document.getElementById('radiusSlider').value);

      // Get crop bounds
      const bounds = getCropBounds(uploadedImage, threshold);

      // Clear canvas
      ctx.clearRect(0, 0, size, size);

      // Create rounded rectangle clipping path
      if (cornerRadius > 0) {
        roundRect(ctx, 0, 0, size, size, cornerRadius);
        ctx.clip();
      }

      // Fill with dark background (for transparent areas)
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, size, size);

      // Calculate scaling to fit cropped image in square
      const scale = size / Math.max(bounds.width, bounds.height);
      const scaledWidth = bounds.width * scale;
      const scaledHeight = bounds.height * scale;

      // Center the image
      const offsetX = (size - scaledWidth) / 2;
      const offsetY = (size - scaledHeight) / 2;

      // Draw cropped and scaled image
      ctx.drawImage(
        uploadedImage,
        bounds.x, bounds.y, bounds.width, bounds.height,
        offsetX, offsetY, scaledWidth, scaledHeight
      );
    }

    function roundRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }

    function updateIcons() {
      if (!uploadedImage) return;

      // Update value displays
      document.getElementById('thresholdValue').textContent =
        document.getElementById('thresholdSlider').value;
      document.getElementById('paddingValue').textContent =
        document.getElementById('paddingSlider').value;
      document.getElementById('radiusValue').textContent =
        document.getElementById('radiusSlider').value + '%';

      // Redraw all icons
      drawIcon(document.getElementById('canvas192'), 192);
      drawIcon(document.getElementById('canvas512'), 512);
      drawIcon(document.getElementById('canvas180'), 180);
    }

    function downloadIcon(size) {
      const canvas = document.getElementById(`canvas${size}`);
      const filename = size === 180 ? 'apple-touch-icon.png' : `icon-${size}x${size}.png`;

      canvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);

        showStatus(`‚úÖ Downloaded: ${filename}`);
      });
    }

    async function downloadAll() {
      const sizes = [192, 512, 180];
      for (const size of sizes) {
        downloadIcon(size);
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      showStatus('‚úÖ All icons downloaded! Save them to the icons/ folder in your project.');
    }

    function showStatus(message) {
      const status = document.getElementById('status');
      status.innerHTML = `<p class="status">${message}</p>`;
      setTimeout(() => {
        status.innerHTML = '';
      }, 5000);
    }
  </script>
</body>
</html>
